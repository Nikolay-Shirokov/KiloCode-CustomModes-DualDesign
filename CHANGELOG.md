# Changelog - Dual Design Mode

## [1.1.0] - 2025-11-16

### Добавлено ⭐ MAJOR FEATURE
- **Интеграция с MCP веб-поиском**: Новый опциональный шаг 1.5 для автоматического исследования технологий и API
- **Автоматическое исследование**: Режим самостоятельно определяет необходимость веб-поиска на основе запроса пользователя
- **Поддержка MCP-серверов**: Exa (рекомендуется), Brave Search, Tavily, любые с search capabilities
- **Контекстное обогащение**: Результаты веб-поиска автоматически передаются Архитектору и Пилоту

### Новая функциональность

#### Шаг 1.5: Веб-исследование (опционально)
Активируется автоматически при наличии MCP-инструмента и одного из условий:
- Упоминание конкретных сервисов (Wildberries, Ozon, Яндекс.Маркет и т.д.)
- Указание технологий (REST API, GraphQL, OAuth)
- Требование интеграции с внешними системами
- Упоминание производительности/масштабирования

**Что делает шаг 1.5:**
1. Анализирует запрос пользователя на необходимость исследования
2. Генерирует 2-4 целевых поисковых запроса
3. Выполняет веб-поиск через доступный MCP-инструмент
4. Сохраняет результаты в `step1.5_web_research.md`
5. Передает контекст Архитектору и Пилоту для более информированных вопросов

### Обновленные компоненты

#### State Management
Добавлены новые поля в `state.json`:
- `webResearchEnabled` (boolean) - доступен ли MCP-поиск
- `webResearchCompleted` (boolean) - выполнен ли поиск
- `mcpToolsAvailable` (array) - список доступных MCP-инструментов
- `searchQueriesExecuted` (array) - выполненные поисковые запросы

#### Структура артефактов
Добавлен опциональный файл:
- `step1.5_web_research.md` - результаты веб-исследования с:
  - Поисковыми запросами
  - Ключевыми находками с источниками
  - Рекомендациями для проектирования
  - Потенциальными рисками

#### Промт-шаблоны
- Добавлен промт для анализа необходимости веб-исследования (возвращает JSON)
- Обновлены промты шагов 2 и 3 для включения контекста веб-исследования

#### Документация
- Обновлена [`dual-design-spec.md`](dual-design-spec.md) с описанием шага 1.5
- Добавлен раздел "Интеграция с MCP-инструментами"
- Добавлены примеры использования с/без веб-поиска
- Обновлен [`IMPLEMENTATION_SUMMARY.md`](IMPLEMENTATION_SUMMARY.md) до версии 1.1.0

### Преимущества веб-исследования

✅ **Актуальность**: AI-модели получают свежую информацию, не из training data  
✅ **Качество вопросов**: Учитываются реальные ограничения API и best practices  
✅ **Автоматизация**: Пользователь не делает ничего дополнительно  
✅ **Опциональность**: Работает с MCP и без него  
✅ **Прозрачность**: Все результаты поиска сохраняются в артефактах

### Пример использования

**Без веб-исследования (v1.0.2):**
```
User: Нужна синхронизация с Wildberries
  ↓
Архитектор и Пилот задают общие вопросы
```

**С веб-исследованием (v1.1.0):**
```
User: Нужна синхронизация с Wildberries
  ↓
Шаг 1.5: Автоматический поиск:
- "Wildberries API документация seller актуальная"
- "1C интеграция Wildberries best practices"
- "Wildberries API лимиты ошибки"
  ↓
Результаты передаются моделям
  ↓
Архитектор и Пилот задают ИНФОРМИРОВАННЫЕ вопросы:
- Учитывают лимит 600 запросов/мин
- Знают об обязательных полях (артикул, баркод)
- Предлагают батчинг до 100 товаров
```

### Технические детали

- Процесс остается обратно совместимым
- Если MCP недоступен, режим работает как в v1.0.2
- Время выполнения: +30-60 сек на веб-исследование (при активации)
- Количество шагов: 9 основных + 1 опциональный

### Breaking Changes

Нет. Полная обратная совместимость с v1.0.2.

---

# Changelog - Dual Design Mode

## [1.0.2] - 2025-11-14

### Добавлено
- **Раздельные worker режимы**: Создано два специализированных режима вместо одного generic worker
  - `dual-design-architect` - для роли Архитектора (шаги 2, 4, 6, 8, 9)
  - `dual-design-copilot` - для роли Второго пилота (шаги 3, 5, 7)
- **Настройка моделей**: Теперь можно выбрать разные AI-модели для каждой роли в UI Kilo Code
- **Документация по моделям**: Создан [`MODEL_CONFIGURATION.md`](MODEL_CONFIGURATION.md) с:
  - Рекомендациями по выбору моделей
  - Сравнением характеристик
  - Примерами комбинаций
  - Troubleshooting

### Улучшено
- Более четкое разделение ответственности между ролями
- Каждый worker режим имеет специализированные инструкции
- Better prompting для каждой роли

### Почему это важно
Теперь можно использовать **реальную коллаборацию разных AI-моделей**:
- Claude Sonnet 4 как Architect + GPT-4o как Co-pilot
- Claude Opus как Architect + GPT-4 как Co-pilot
- Любые другие комбинации

Это дает:
- Разные перспективы на задачу
- Более критичный анализ
- Лучшее качество требований

## [1.0.1] - 2025-11-14

### Исправлено
- **Критическое исправление**: Создан специализированный режим `dual-design-worker` для работы в автоматическом конвейере
- Режим `dual-design` теперь использует `dual-design-worker` вместо `ask` для создания задач
- Устранена проблема с блокировкой процесса из-за `ask_followup_question` в режиме `ask`

### Добавлено
- Новый внутренний режим `dual-design-worker` (slug: `dual-design-worker`)
- Worker режим не имеет доступа к `ask_followup_question` и всегда дает полный ответ
- Четкие инструкции для worker режима о необходимости завершения анализа в одном сообщении

### Технические детали

#### Проблема
При использовании режима `ask` для создания задач через `new_task`, модели получали доступ к инструменту `ask_followup_question` и использовали его, что приводило к остановке автоматического процесса на ожидании ответа от пользователя.

#### Решение
Создан специализированный режим `dual-design-worker` со следующими характеристиками:

1. **Ограниченные группы доступа**: только `read` (без интерактивных инструментов)
2. **Явные инструкции**: 
   - НИКОГДА не использовать `ask_followup_question`
   - ВСЕГДА давать полный ответ немедленно
   - Делать разумные предположения при недостатке контекста
3. **Четкое определение роли**: Worker для автоматического конвейера, не для прямого взаимодействия с пользователем

#### Изменения в `.kilocodemodes`

**Строки 776-851**: Добавлен новый режим `dual-design-worker`
```yaml
- slug: dual-design-worker
  name: Dual Design Worker
  groups:
    - read  # Только чтение, без интерактивных инструментов
```

**Строка 683**: Обновлен `dual-design` для использования worker режима
```yaml
# Было:
- Use `new_task` tool to create tasks (mode: 'ask')

# Стало:
- Use `new_task` tool to create tasks (mode: 'dual-design-worker')
```

### Инструкции по обновлению

1. Перезагрузите VSCode для применения изменений в `.kilocodemodes`
2. Убедитесь что режим "Dual Design Worker" появился в списке (хотя использовать его напрямую не нужно)
3. Попробуйте снова запустить процесс в режиме "Dual Design"

### Ожидаемое поведение после исправления

- Шаги 2-8 выполняются полностью автоматически без остановок
- Worker модели дают полные развернутые ответы сразу
- Процесс останавливается только на Шаге 8 для показа финальных вопросов пользователю
- Общее время автоматических шагов: 3-5 минут

---

## [1.0.0] - 2025-11-14

### Добавлено
- Начальный релиз режима Dual Design
- Автоматизация 9-шагового процесса коллаборативного проектирования
- Система артефактов с полной прозрачностью процесса
- Интеграция с режимами design-1c-object, plantasks1c, code1c
- Полная документация (README, Quick Start, User Guide, Spec)
- План тестирования

### Режимы
- `dual-design` - основной оркестратор для коллаборативного проектирования
- `dual-design-worker` - внутренний worker для автоматического конвейера